<html>
    <head>
        <center>
        <meta charset="utf-8">
        <title>Upload list</title>
        <link rel="stylsheet" href="/static/admin/css/style2.css">
    </head>
    <style>
      h1 {
            color: green;
            font-size: 50px;
            }
        table.blueTable {
            border: 0px solid #1C6EA4;
            background-color: #EEEEEE;
            width: 100%;
            text-align: center;
            border-collapse: collapse;
          }
          table.blueTable td, table.blueTable th {
            border: 1px solid #AAAAAA;
            padding: 4px 2px;
          }
          table.blueTable tbody td {
            font-size: 19px;
            font-weight: bold;
          }
          table.blueTable tr:nth-child(even) {
            background: #D0E4F5;
          }
          table.blueTable thead {
            background: #1C6EA4;
            background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
            background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
            background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
            border-bottom: 2px solid #444444;
          }
          table.blueTable thead th {
            font-size: 18px;
            font-weight: bold;
            color: #FFFFFF;
            text-align: center;
            border-left: 2px solid #D0E4F5;
          }
          table.blueTable thead th:first-child {
            border-left: none;
          }
          
          table.blueTable tfoot {
            font-size: 12px;
            font-weight: bold;
            color: #FFFFFF;
            background: #D0E4F5;
            background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
            background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
            background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
            border-top: 2px solid #444444;
          }
          table.blueTable tfoot td {
            font-size: 12px;
          }
          table.blueTable tfoot .links {
            text-align: right;
          }
          table.blueTable tfoot .links a{
            display: inline-block;
            background: #1C6EA4;
            color: #FFFFFF;
            padding: 2px 8px;
            border-radius: 5px;
          }
          .interview-button[disabled]{
            background-color: gray;
         }
        </style>
    <body> 
        <div class="jobs-details">
            <div class="job">
              
                <h1>{{job.subTitle}}</h1>
                <small><b>By:</b>{{job.owner.username}}</small>
                <p><b>job description:</b>{{job.body}}</p>
                <p><b>category:</b> {{job.get_category_display}}</p>

                <p><b>Salary range:</b> {{job.get_salaryRange_display}}</p>

                <p><b>date of publish:</b> {{job.date}}</p>

                <p><b>Years of expirience:</b> {{job.get_yearsexp_display}}</p>
                <p><b>Education:</b> {{job.education}}</p>
                <p><b>Time</b>: {{job.get_time_display}}</p>
                <p><b>Location:</b> {{job.get_location_display}}</p>
                <p><b>Avaliable Amount:</b> {{job.availableAmount }}</p>

            </div>
        </div>

        {% if request.user.is_authenticated %}
          {% if request.user.employer.is_employer and request.user.employer.username == job.owner.username %}
                  <a href="{% url 'update' job %}">
                    <button>Edit job</button>
                    </a>
               
                <a href="{% url 'deleteJob' job  %}">
                    <button>Delete Job</button>
                    </a>
                <br>
          {% endif %}
          {% if request.user.candidate.is_candidate %}
              {% if job.availableAmount > 0 %}
                  <a href="{% url 'ApllyCv' job  %}">
                  <button>Apply CV</button>
                  </a>
              {% endif %}
          {% endif %}
          <br>
            
          {% if request.user.employer.is_employer and request.user.employer.username == job.owner.username %}
            <button id="button">Resume pending</button>
            <div id="myDiv" style="display: none;">
                <table class="blueTable">
                    <br>
                    <br>
                    <thead>
                    <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>first name</th>
                    <th>last name</th>
                    <th>phone</th>
                    <th>link</th>
                        
                    </tr>
                    </thead>
                    {% for d in job.applycandiadteuser.all %}
                    <tbody>
                        <tr>
                        <td>{{d.username}}</td>
                        <td>{{d.email}}</td>
                        <td>{{d.first_name}}</td>
                        <td>{{d.last_name}}</td>
                        <td>{{d.phone_number}}</td>
                        <td>
                          <a href="{% url 'Profile' d.username  %}">
                              <button>Profile</button>
                          </a>
                          <form action="{% url 'update_user' d.username %}" method="post">
                              {% csrf_token %}
                              <input type="hidden" name="status" value="accepted">
                              <input type="hidden" name="jobtitle" value="{{ job.title }}">
                              <button class="interview-button" id="accept-button" type="submit">Accept</button>
                              <button class="interview-button" id="interview-button" type="submit">Interview</button>
                          </form>
                          <form action="{% url 'abort_user' d.username %}" method="post">
                              {% csrf_token %}
                              <input type="hidden" name="status" value="accepted">
                              <input type="hidden" name="jobtitle" value="{{ job.title }}">
                              <button class="interview-button" id="reject-button" type="submit">Reject</button>
                          </form>
                          <form action="{% url 'hired_user' d.username %}" method="post">
                              {% csrf_token %}
                              <input type="hidden" name="status" value="accepted">
                              <input type="hidden" name="jobtitle" value="{{ job.title }}">
                              <button class="interview-button" id="hire-button" type="submit">Hired</button>
                          </form>
                        </tr>
                    </tbody>                    
                    
                    {% endfor %}
                </table>
            </div>

          {% endif %}
        {% endif %}
        <br/><br/>
        <br/><br/>
        <a href="{% url 'list' %}">
            <button>Back to JobList</button>
            </a>
        
    </body></center>
    <script>
      document.getElementById("button").addEventListener("click", function() {
        var x = document.getElementById("myDiv");
        if (x.style.display === "none") {
          x.style.display = "block";
        } else {
          x.style.display = "none";
        }
      });
            // Function to get a cookie by its name
      function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
      }

      // Function to set a cookie
      function setCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "")  + expires + "; path=/";
      }

      // Add event listener to buttons
      window.onload = function() {
        const acceptButton = document.getElementById("accept-button");
        const interviewButton = document.getElementById("interview-button");
        const rejectButton = document.getElementById("reject-button");
        const hireButton = document.getElementById("hire-button");
      
        if (localStorage.getItem(acceptButton.id)) {
          acceptButton.disabled = true;
          acceptButton.style.backgroundColor = "gray";
        }
        if (localStorage.getItem(interviewButton.id)) {
          interviewButton.disabled = true;
          interviewButton.style.backgroundColor = "gray";
        }
        if (localStorage.getItem(rejectButton.id)) {
          rejectButton.disabled = true;
          rejectButton.style.backgroundColor = "gray";
        }
        if (localStorage.getItem(hireButton.id)) {
          hireButton.disabled = true;
          hireButton.style.backgroundColor = "gray";
        }
      
        acceptButton.addEventListener("click", function() {
          localStorage.setItem(this.id, true);
          this.disabled = true;
          this.style.backgroundColor = "gray";
        });
        interviewButton.addEventListener("click", function() {
          localStorage.setItem(this.id, true);
          this.disabled = true;
          this.style.backgroundColor = "gray";
        });
        rejectButton.addEventListener("click", function() {
          localStorage.setItem(this.id, true);
          this.disabled = true;
          this.style.backgroundColor = "gray";
        });
        hireButton.addEventListener("click", function() {
          localStorage.setItem(this.id, true);
          this.disabled = true;
          this.style.backgroundColor = "gray";
        });
      };
      
      </script>
</html>